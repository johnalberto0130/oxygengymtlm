<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeu XO</title>
<style>
    body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
    }
    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: red;
        color: white;
        border: none;
        font-size: 1.2em;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
    }
    .level-selection {
        margin-bottom: 20px;
    }
    select {
        padding: 5px;
        font-size: 1em;
    }
    .game-container {
        background: #000;
        border: 3px solid #0f0;
        box-shadow: 0 0 20px #0f0;
        padding: 15px;
        border-radius: 15px;
        display: inline-block;
        max-width: 95vw;
        position: relative;
    }
    .board {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        gap: 5px;
        justify-content: center;
    }
    .cell {
        width: 100px;
        height: 100px;
        background: #222;
        font-size: 2.5em;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: white;
        box-shadow: 0 0 10px #0f0 inset;
        border-radius: 5px;
    }
    .cell.X { color: red; }
    .cell.O { color: yellow; }
    .message {
        margin: 15px 0;
        font-size: 1.2em;
    }
    button {
        background: #0f0;
        color: #000;
        border: none;
        padding: 10px 20px;
        font-size: 1em;
        cursor: pointer;
        border-radius: 8px;
        margin-top: 10px;
    }
    button:hover {
        background: #0c0;
    }
    @media (max-width: 500px) {
        .board {
            grid-template-columns: repeat(3, 80px);
        }
        .cell {
            width: 80px;
            height: 80px;
            font-size: 2em;
        }
    }
</style>
</head>
<body>

<button class="close-btn" onclick="closeGame()">X</button>

<h1>Jeu XO</h1>
<div class="level-selection">
    <label for="level">Choisissez le niveau :</label>
    <select id="level">
        <option value="facile">Facile</option>
        <option value="difficile">Difficile</option>
        <option value="pro">Pro</option>
    </select>
    <button onclick="startGame()">Commencer</button>
</div>

<div class="game-container" id="game-container" style="display:none;">
    <div class="board" id="board"></div>
    <div class="message" id="message">Votre tour !</div>
    <button onclick="resetGame()">Rejouer</button>
</div>

<audio id="clapSound" src="https://www.soundjay.com/human/applause-8.mp3"></audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    const boardEl = document.getElementById("board");
    const messageEl = document.getElementById("message");
    const clapSound = document.getElementById("clapSound");
    let board, gameActive, currentPlayer, level;

    function startGame() {
        level = document.getElementById("level").value;
        document.getElementById("game-container").style.display = "inline-block";
        createBoard();
        messageEl.textContent = "Votre tour !";
    }

    function closeGame() {
        document.getElementById("game-container").style.display = "none";
    }

    function createBoard() {
        boardEl.innerHTML = "";
        board = ["", "", "", "", "", "", "", "", ""];
        gameActive = true;
        currentPlayer = "X";
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement("div");
            cell.classList.add("cell");
            cell.dataset.index = i;
            cell.addEventListener("click", handleClick);
            boardEl.appendChild(cell);
        }
    }

    function handleClick(e) {
        const index = e.target.dataset.index;
        if (!gameActive || board[index] !== "") return;
        makeMove(index, currentPlayer);
        if (checkWinner(currentPlayer)) {
            endGame(true);
            return;
        }
        if (!board.includes("")) {
            endGame(false);
            return;
        }
        currentPlayer = "O";
        setTimeout(computerMove, 500);
    }

    function makeMove(index, player) {
        board[index] = player;
        const cell = boardEl.querySelector(`[data-index="${index}"]`);
        cell.textContent = player;
        cell.classList.add(player);
    }

    function computerMove() {
        let move;
        if (level === "facile") {
            move = randomMove();
        } else if (level === "difficile") {
            move = blockMove() ?? randomMove();
        } else if (level === "pro") {
            move = winMove() ?? blockMove() ?? randomMove();
        }
        makeMove(move, "O");
        if (checkWinner("O")) {
            endGame(true, false);
            return;
        }
        if (!board.includes("")) {
            endGame(false);
            return;
        }
        currentPlayer = "X";
    }

    function randomMove() {
        let emptyIndices = board.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
        return emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
    }

    function blockMove() {
        return findBestMove("X");
    }

    function winMove() {
        return findBestMove("O");
    }

    function findBestMove(player) {
        const wins = [
            [0,1,2],[3,4,5],[6,7,8],
            [0,3,6],[1,4,7],[2,5,8],
            [0,4,8],[2,4,6]
        ];
        for (let comb of wins) {
            const [a,b,c] = comb;
            let values = [board[a], board[b], board[c]];
            if (values.filter(v => v === player).length === 2 && values.includes("")) {
                return comb[values.indexOf("")];
            }
        }
        return null;
    }

    function checkWinner(player) {
        const wins = [
            [0,1,2],[3,4,5],[6,7,8],
            [0,3,6],[1,4,7],[2,5,8],
            [0,4,8],[2,4,6]
        ];
        return wins.some(comb => comb.every(idx => board[idx] === player));
    }

    function endGame(win, player=true) {
        gameActive = false;
        if (win && player) {
            messageEl.textContent = "ðŸŽ‰ FÃ©licitations, vous avez gagnÃ© ! ðŸŽ‰";
            clapSound.play();
            for (let i = 0; i < 20; i++) {
                let confetti = document.createElement("div");
                confetti.textContent = "ðŸŽ‰";
                confetti.style.position = "fixed";
                confetti.style.left = Math.random() * window.innerWidth + "px";
                confetti.style.top = "-20px";
                document.body.appendChild(confetti);
                gsap.to(confetti, {y: window.innerHeight + 50, rotation: Math.random() * 360, duration: 2 + Math.random()*2, onComplete: ()=>confetti.remove()});
            }
        } else if (win && !player) {
            messageEl.textContent = "ðŸ˜… Vous avez perdu, rÃ©essayez !";
        } else {
            messageEl.textContent = "Match nul !";
        }
    }

    function resetGame() {
        createBoard();
        messageEl.textContent = "Votre tour !";
    }
</script>

</body>
</html>
