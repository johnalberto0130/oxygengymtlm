<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeu Fruit Ninja Emoji - OXYGENE GAMES</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    overflow: hidden;
  }
  .game-container {
    position: relative;
    width: 360px;
    height: 80vh;
    max-height: 700px;
    background: #111;
    border-radius: 15px;
    box-shadow: 0 0 25px #0f0;
    overflow: hidden;
  }
  .scoreboard {
    position: absolute;
    top: 10px;
    left: 15px;
    color: #0f0;
    font-weight: bold;
    font-size: 20px;
    text-shadow: 0 0 8px #0f0;
    user-select: none;
  }
  .scoreboard .score,
  .scoreboard .survie {
    margin-bottom: 4px;
  }
  .timer {
    position: absolute;
    top: 10px;
    right: 15px;
    color: #0f0;
    font-weight: bold;
    font-size: 20px;
    text-shadow: 0 0 8px #0f0;
  }
  .emoji {
    position: absolute;
    font-size: 50px;
    user-select: none;
    cursor: pointer;
    touch-action: manipulation;
    will-change: transform, opacity;
    text-shadow: 0 0 5px #0f0;
  }
  .message {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 90%;
    transform: translate(-50%, -50%);
    background: #0f0;
    color: #000;
    padding: 20px 30px;
    border-radius: 15px;
    font-size: 22px;
    font-weight: bold;
    display: none;
    box-shadow: 0 0 25px #0f0;
    text-align: center;
  }
  .button-restart, .button-start {
    margin-top: 15px;
    background: #0f0;
    color: #000;
    border: none;
    padding: 10px 25px;
    font-weight: bold;
    font-size: 18px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 0 15px #0f0;
    transition: background 0.3s ease;
  }
  .button-restart:hover, .button-start:hover {
    background: #0c0;
  }
  .overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 15px;
    z-index: 10;
  }
</style>
</head>
<body>

<div class="game-container" tabindex="0">
  <div class="scoreboard">
    <div class="score">Score üî•: <span id="score">0</span></div>
    <div class="survie">Survie ‚ùå: <span id="survie">0</span></div>
  </div>
  <div class="timer">Temps ‚è≥: <span id="timer">45</span>s</div>
  <div class="message" id="message"></div>

  <div class="overlay" id="startOverlay">
    <button class="button-start" id="startBtn">Start</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.min.js"></script>
<script>
  const emojis = ['‚öΩ', 'üèãÔ∏è', 'ü§æ', 'ü§∏', 'üßó', 'üèÉ', 'ü§º', 'üßò'];
  const gameContainer = document.querySelector('.game-container');
  const scoreEl = document.getElementById('score');
  const survieEl = document.getElementById('survie');
  const timerEl = document.getElementById('timer');
  const messageEl = document.getElementById('message');
  const startOverlay = document.getElementById('startOverlay');
  const startBtn = document.getElementById('startBtn');

  let score = 0;
  let survie = 0;
  let emojiElements = [];
  let gameDuration = 45; // seconds
  let countdownInterval;
  let spawnInterval;
  let gameActive = false;

  // ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™
  const cutSound = new Tone.PolySynth().toDestination();
  const bombSound = new Tone.Synth({
    oscillator: { type: "square" },
    envelope: {
      attack: 0.05,
      decay: 0.1,
      sustain: 0.1,
      release: 0.5,
    },
  }).toDestination();
  const applauseSound = new Tone.Player("https://s3-us-west-2.amazonaws.com/s.cdpn.io/85121/applause.wav").toDestination();
  const sadSound = new Tone.Player("https://s3-us-west-2.amazonaws.com/s.cdpn.io/85121/wah-wah-wah.mp3").toDestination();

  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function spawnEmoji() {
    if (!gameActive) return;
    if (emojiElements.length >= 6) return;

    const emoji = document.createElement('div');
    emoji.classList.add('emoji');
    emoji.textContent = emojis[randomInt(0, emojis.length - 1)];
    emoji.style.left = randomInt(20, gameContainer.offsetWidth - 70) + 'px';
    emoji.style.bottom = '-60px';
    gameContainer.appendChild(emoji);
    emojiElements.push(emoji);

    // ÿµÿπŸàÿØ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ŸÖÿπ ÿ≠ÿ±ŸÉÿ© ÿ£ŸÅŸÇŸäÿ© ÿ™ÿ∞ÿ®ÿ∞ÿ®Ÿäÿ©
    gsap.to(emoji, {
      duration: randomInt(3, 5),
      bottom: gameContainer.offsetHeight + 60,
      ease: "power1.out",
      onComplete: () => {
        if (gameActive) {
          removeEmoji(emoji);
          survie++;
          updateScoreboard();
          if (survie >= 5) {
            endGame();
          }
        }
      }
    });
    gsap.to(emoji, {
      duration: randomInt(1, 3),
      x: "+=30",
      yoyo: true,
      repeat: -1,
      ease: "sine.inOut"
    });

    // ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ±: ŸÇÿ∑ÿπ Ÿàÿ≥ŸÇŸàÿ∑
    function onClickHandler() {
      if (!gameActive) return;
      if (emoji.dataset.cut === "true") return;
      emoji.dataset.cut = "true";
      emoji.removeEventListener('click', onClickHandler);
      score++;
      updateScoreboard();
      cutSound.triggerAttackRelease("C4", "8n");
      gsap.killTweensOf(emoji);
      gsap.to(emoji, {
        rotation: randomInt(-90, 90),
        y: "+=100",
        opacity: 0,
        duration: 0.6,
        ease: "power1.in",
        onComplete: () => {
          removeEmoji(emoji);
        }
      });
    }
    emoji.addEventListener('click', onClickHandler);
  }

  function removeEmoji(emoji) {
    if (!emoji) return;
    const index = emojiElements.indexOf(emoji);
    if (index > -1) emojiElements.splice(index, 1);
    emoji.remove();
  }

  function updateScoreboard() {
    scoreEl.textContent = score;
    survieEl.textContent = survie;
  }

  function startGame() {
    score = 0;
    survie = 0;
    gameDuration = 45;
    updateScoreboard();
    timerEl.textContent = gameDuration;
    messageEl.style.display = 'none';
    gameActive = true;
    startOverlay.style.display = 'none';

    countdownInterval = setInterval(() => {
      gameDuration--;
      timerEl.textContent = gameDuration;
      if (gameDuration <= 0) {
        endGame();
      }
    }, 1000);

    spawnInterval = setInterval(spawnEmoji, 700);
  }

  function endGame() {
    gameActive = false;
    clearInterval(countdownInterval);
    clearInterval(spawnInterval);
    emojiElements.forEach(e => e.remove());
    emojiElements = [];

    let diff = score - survie;
    let win = diff > 0;
    let msg = '';

    if (win) {
      msg = `üî• Bravo! Vous avez plus de coup√©s que de survivants (${score} vs ${survie}) üéâ`;
      playConfetti();
      playApplause();
    } else {
      msg = `‚ùå Tu as plus de survivants que de coup√©s (${survie} vs ${score}) üò≠ \nInscrivez-vous √† "OXYGENE GYM" pour am√©liorer votre rapidit√©!`;
      playSadSound();
      playEmojiRain('üò≠');
    }

    messageEl.textContent = msg;
    messageEl.style.display = 'block';

    const restartBtn = document.createElement('button');
    restartBtn.textContent = 'Recommencer';
    restartBtn.classList.add('button-restart');
    restartBtn.onclick = () => {
      messageEl.style.display = 'none';
      startOverlay.style.display = 'flex';
    };
    messageEl.appendChild(document.createElement('br'));
    messageEl.appendChild(restartBtn);
  }

  // ŸÖÿ§ÿ´ÿ±ÿßÿ™ GSAP
  function playConfetti() {
    const confettiColors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
    for (let i = 0; i < 30; i++) {
      const confetti = document.createElement('div');
      confetti.style.position = 'absolute';
      confetti.style.width = '10px';
      confetti.style.height = '10px';
      confetti.style.backgroundColor = confettiColors[randomInt(0, confettiColors.length - 1)];
      confetti.style.borderRadius = '50%';
      confetti.style.left = `${randomInt(0, gameContainer.offsetWidth)}px`;
      confetti.style.top = `${randomInt(0, gameContainer.offsetHeight)}px`;
      gameContainer.appendChild(confetti);

      gsap.to(confetti, {
        duration: randomInt(1, 3) + 1,
        x: randomInt(-200, 200),
        y: randomInt(-200, 200),
        opacity: 0,
        ease: "power1.out",
        onComplete: () => confetti.remove()
      });
    }
  }

  function playEmojiRain(emoji) {
    for (let i = 0; i < 20; i++) {
      const rainEmoji = document.createElement('div');
      rainEmoji.classList.add('emoji');
      rainEmoji.textContent = emoji;
      rainEmoji.style.left = `${randomInt(0, gameContainer.offsetWidth - 50)}px`;
      rainEmoji.style.top = `-50px`;
      gameContainer.appendChild(rainEmoji);

      gsap.to(rainEmoji, {
        duration: randomInt(2, 4) + 1,
        top: gameContainer.offsetHeight + 50,
        rotation: 360,
        opacity: 0,
        ease: "power1.in",
        onComplete: () => rainEmoji.remove()
      });
    }
  }

  function playApplause() {
    applauseSound.start();
  }

  function playSadSound() {
    sadSound.start();
  }

  startBtn.addEventListener('click', () => {
    // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿπŸÜÿßÿµÿ± ÿ≥ÿßÿ®ŸÇÿ© ŸÇÿ®ŸÑ ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©
    emojiElements.forEach(e => e.remove());
    emojiElements = [];
    startGame();
  });

  gameContainer.addEventListener('click', (e) => {
    // ŸÑŸÖŸÜÿπ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿÆŸÑŸÅŸäÿ© ÿßŸÑŸÑÿπÿ®ÿ© ŸÖŸÜ ÿ≠ÿ¨ÿ® ÿßŸÑŸÜŸÇÿ±ÿßÿ™
    e.stopPropagation();
  });
</script>
</body>
</html>
