<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OXYGENE GAMES</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        /*
        هذا الجزء من الـ CSS مأخوذ مباشرة من ملفك 'index.html' لضمان التناسق.
        */
        :root {
            --main-color: #00ff88;
            --dark-bg: #111;
            --text-color: #f0f0f0;
            --shadow-light: rgba(0, 255, 136, 0.5);
            --shadow-dark: rgba(0, 0, 0, 0.8);
            --orange-light: #FF8C00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            direction: rtl; /* اتجاه الكتابة من اليمين لليسار */
            text-align: right; /* محاذاة النص لليمين */
        }
        
        /* New Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.95);
            padding: 50px 30px;
            transform: translateX(-100%);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            transition: transform 0.6s cubic-bezier(0.86, 0, 0.07, 1);
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2.5em;
            color: var(--main-color);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .sidebar-close-btn:hover {
            transform: rotate(90deg);
        }
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            text-align: right; /* محاذاة لليمين */
        }
        .sidebar-menu li {
            opacity: 1;
            transform: translateY(20px);
            margin-bottom: 30px;
        }
        .sidebar-menu a {
            font-family: 'Anton', sans-serif;
            font-size: 2em;
            color: var(--text-color);
            text-decoration: none;
            text-transform: uppercase;
            transition: color 0.3s, letter-spacing 0.3s;
            display: block;
            border-bottom: 2px solid transparent;
            padding-bottom: 5px;
        }
        .sidebar-menu a:hover {
            color: var(--main-color);
            letter-spacing: 2px;
            border-bottom: 2px solid var(--main-color);
        }
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px; /* تغيير الموقع إلى اليمين */
            width: 50px;
            height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            cursor: pointer;
            z-index: 1001;
            padding: 10px;
            background-color: var(--dark-bg);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
            transition: box-shadow 0.3s;
        }
        .menu-toggle:hover {
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
        }
        .menu-toggle span {
            display: block;
            width: 100%;
            height: 4px;
            background-color: var(--main-color);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .main-header {
            background-color: transparent;
            padding: 20px;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 998;
            font-family: 'Anton', sans-serif;
        }

        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
        }

        .header-logo {
            width: 150px;
            transition: transform 0.3s ease;
        }
        .header-logo:hover {
            transform: scale(1.1);
        }

        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
        }
        .main-nav a {
            color: var(--text-color);
            text-decoration: none;
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s, text-shadow 0.3s;
        }
        .main-nav a:hover {
            color: var(--main-color);
            text-shadow: 0 0 10px var(--shadow-light);
        }

        .nav-toggle-btn {
            background: none;
            border: none;
            color: var(--main-color);
            font-size: 1.5em;
            cursor: pointer;
            display: none;
        }

        @media (max-width: 768px) {
            .main-nav {
                display: none;
            }
            .nav-toggle-btn {
                display: block;
            }
            .main-header .container {
                justify-content: space-between;
            }
        }
        
        /* CSS الخاص بصفحة الألعاب الجديدة */
        .games-section {
            padding: 100px 20px 80px; /* مسافة علوية لتجنب التداخل مع الهيدر */
            max-width: 1200px;
            margin: auto;
            text-align: center;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .game-card {
            background-color: #222;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(0, 255, 136, 0.1), rgba(255, 140, 0, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-card:hover::before {
            opacity: 1;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .game-card h3 {
            font-family: 'Anton', sans-serif;
            font-size: 1.8em;
            color: var(--orange-light);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .game-card p {
            font-size: 0.9em;
            color: #ccc;
            flex-grow: 1;
            position: relative;
            z-index: 1;
        }
        
        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .memory-card {
            width: 100%;
            padding-bottom: 100%; /* Maintain aspect ratio */
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-back, .card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            color: var(--text-color);
        }
        
        .card-back {
            background-color: var(--main-color);
        }
        
        .card-front {
            background-color: #333;
            transform: rotateY(180deg);
        }

        .game-card canvas {
            display: block;
            border-radius: 10px;
            border: 2px solid var(--main-color);
            margin-top: 20px;
            margin-bottom: 20px;
            background-color: #000;
            position: relative;
            z-index: 1;
        }

        .btn-play {
            background-color: var(--main-color);
            color: var(--dark-bg);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--shadow-light);
            text-decoration: none;
            margin-top: 15px;
            display: inline-block;
            position: relative;
            z-index: 1;
        }

        .btn-play:hover {
            background-color: #00e078;
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--shadow-light);
        }
        
        .game-controls {
            display: flex; /* تغيير من none إلى flex */
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .game-controls button {
            background-color: #333;
            color: var(--text-color);
            border: 1px solid var(--main-color);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .game-controls button:hover {
            background-color: var(--main-color);
            color: var(--dark-bg);
        }

        .game-message {
            color: var(--orange-light);
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            background: #000;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #333;
            margin-top: 50px;
        }
        
        /* Mobile adjustments for the games grid */
        @media (max-width: 768px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            .game-card {
                padding: 20px;
            }
            .game-card h3 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>

    <!-- New Sidebar (from index.html) -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-close-btn" id="sidebar-close">&times;</div>
        <ul class="sidebar-menu">
            <li><a href="index.html">Accueil</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="challenges.html">Challenges</a></li>
            <li><a href="oxygen game.html">OXYGEN GAMES</a></li>
        </ul>
    </div>
    
    <!-- Menu Toggle (from index.html) -->
    <div class="menu-toggle" id="menu-toggle">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- Header (from index.html) -->
    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo-link">
                <img src="https://i.ibb.co/4gJNrzkD/09016f5a-d244-45d0-9642-63dbb8185dde-removalai-preview.png" alt="شعار OXYGENE GYM" class="header-logo">
            </a>
            <!-- Nav-toggle-btn is now handled by the sidebar toggle button -->
        </div>
    </header>

    <main>
        <section class="games-section">
            <h2>OXYGENE GAMES</h2>
            <p style="font-size: 1.2em; max-width: 800px; margin: auto; margin-bottom: 40px; color: #aaa;">
                استرخِ وشارك في ألعابنا الرياضية الذهنية. اختبر تركيزك وردود أفعالك!
            </p>

            <div class="games-grid">
                <!-- Tic-Tac-Toe Game -->
                <div class="game-card">
                    <h3>Tic-Tac-Toe</h3>
                    <p>لعبة X و O الكلاسيكية. تحدى صديقك أو العب ضد الكمبيوتر.</p>
                    <canvas id="tic-tac-toe-canvas" width="250" height="250"></canvas>
                    <div class="game-controls">
                        <div id="ttt-message" class="game-message"></div>
                        <button onclick="resetGame('ttt')">إعادة تعيين</button>
                    </div>
                </div>

                <!-- Memory Game -->
                <div class="game-card">
                    <h3>Memory Game</h3>
                    <p>اختبر ذاكرتك! اعثر على أزواج البطاقات المتطابقة بأقل عدد من المحاولات.</p>
                    <div id="memory-game-board" class="memory-board"></div>
                    <div class="game-controls">
                        <div id="memory-message" class="game-message"></div>
                        <button onclick="resetGame('memory')">إعادة تعيين</button>
                    </div>
                </div>
                
                <!-- Snake Game -->
                <div class="game-card">
                    <h3>Snake Game</h3>
                    <p>وجه الثعبان ليأكل الطعام ويزداد طوله. تجنب الاصطدام بالجدران أو بنفسك!</p>
                    <canvas id="snake-canvas" width="250" height="250"></canvas>
                    <div class="game-controls">
                        <div id="snake-message" class="game-message"></div>
                        <button onclick="resetGame('snake')">إعادة تعيين</button>
                    </div>
                </div>
                
                <!-- Brick Breaker -->
                <div class="game-card">
                    <h3>Brick Breaker</h3>
                    <p>تحكم بالمضرب لكسر جميع الطوب. لا تدع الكرة تسقط!</p>
                    <canvas id="brick-breaker-canvas" width="250" height="250"></canvas>
                    <div class="game-controls">
                        <div id="bb-message" class="game-message"></div>
                        <button onclick="resetGame('brick-breaker')">إعادة تعيين</button>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- Footer (from index.html) -->
    <footer>
        <p>© 2025 OXYGENE GYM. جميع الحقوق محفوظة.</p>
    </footer>

    <script>
        // --- Sidebar JS (from index.html) ---
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarCloseBtn = document.getElementById('sidebar-close');
        const sidebarMenuItems = document.querySelectorAll('.sidebar-menu li');

        const tl = gsap.timeline({ paused: true });
        tl.to(sidebar, {
            x: '0%',
            duration: 0.6,
            ease: 'power3.inOut'
        });
        tl.from(sidebarMenuItems, {
            y: 20,
            opacity: 0,
            stagger: 0.1,
            ease: 'power2.out'
        }, "-=0.3");

        menuToggle.addEventListener('click', () => {
            tl.play();
        });

        sidebarCloseBtn.addEventListener('click', () => {
            tl.reverse();
        });
        
        // --- Game Logic ---
        
        // General game variables
        let gameInstances = {};
        
        // Global reset function
        function resetGame(gameId) {
            if (gameInstances[gameId]) {
                gameInstances[gameId].reset();
            }
        }
        
        // Tic-Tac-Toe Game
        function TicTacToe(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const messageElement = canvas.closest('.game-card').querySelector('.game-message');
            let board = ['', '', '', '', '', '', '', '', ''];
            let currentPlayer = 'X';
            let gameActive = true;
            const winningCombinations = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            
            const drawBoard = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--main-color');
                ctx.lineWidth = 5;
                
                // Draw grid lines
                ctx.beginPath();
                ctx.moveTo(canvas.width / 3, 0);
                ctx.lineTo(canvas.width / 3, canvas.height);
                ctx.moveTo(canvas.width / 3 * 2, 0);
                ctx.lineTo(canvas.width / 3 * 2, canvas.height);
                ctx.moveTo(0, canvas.height / 3);
                ctx.lineTo(canvas.width, canvas.height / 3);
                ctx.moveTo(0, canvas.height / 3 * 2);
                ctx.lineTo(canvas.width, canvas.height / 3 * 2);
                ctx.stroke();
                
                // Draw X's and O's
                ctx.font = '80px Anton, sans-serif';
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                board.forEach((cell, index) => {
                    const row = Math.floor(index / 3);
                    const col = index % 3;
                    const x = (col * canvas.width / 3) + (canvas.width / 6);
                    const y = (row * canvas.height / 3) + (canvas.height / 6);
                    if (cell) {
                        ctx.fillText(cell, x, y);
                    }
                });
            };
            
            const handleResultValidation = () => {
                let roundWon = false;
                for (let i = 0; i < winningCombinations.length; i++) {
                    const winCondition = winningCombinations[i];
                    let a = board[winCondition[0]];
                    let b = board[winCondition[1]];
                    let c = board[winCondition[2]];
                    if (a === '' || b === '' || c === '') {
                        continue;
                    }
                    if (a === b && b === c) {
                        roundWon = true;
                        break;
                    }
                }
                
                if (roundWon) {
                    messageElement.innerText = `اللاعب ${currentPlayer} فاز!`;
                    gameActive = false;
                    return;
                }
                
                let roundDraw = !board.includes('');
                if (roundDraw) {
                    messageElement.innerText = 'تعادل!';
                    gameActive = false;
                    return;
                }
                
                // Switch player
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                messageElement.innerText = `الدور للاعب ${currentPlayer}`;
            };
            
            const handleCellClick = (event) => {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                const col = Math.floor(x / (canvas.width / 3));
                const row = Math.floor(y / (canvas.height / 3));
                const clickedCellIndex = row * 3 + col;
                
                if (board[clickedCellIndex] === '' && gameActive) {
                    board[clickedCellIndex] = currentPlayer;
                    drawBoard();
                    handleResultValidation();
                }
            };
            
            const reset = () => {
                board = ['', '', '', '', '', '', '', '', ''];
                gameActive = true;
                currentPlayer = 'X';
                messageElement.innerText = `الدور للاعب ${currentPlayer}`;
                drawBoard();
            };
            
            canvas.addEventListener('click', handleCellClick);
            this.reset = reset;
            drawBoard();
        }
        
        // Memory Game
        function MemoryGame(boardId) {
            const boardElement = document.getElementById(boardId);
            const messageElement = boardElement.closest('.game-card').querySelector('.game-message');
            const images = [
                '<i class="fa-solid fa-dumbbell"></i>',
                '<i class="fa-solid fa-weight-lifter"></i>',
                '<i class="fa-solid fa-running"></i>',
                '<i class="fa-solid fa-heart-pulse"></i>',
                '<i class="fa-solid fa-fire"></i>',
                '<i class="fa-solid fa-person-swimming"></i>',
                '<i class="fa-solid fa-bicycle"></i>',
                '<i class="fa-solid fa-basketball"></i>'
            ];
            let cards = [...images, ...images];
            let flippedCards = [];
            let matchedCards = [];
            let gameActive = true;
            let moves = 0;

            const shuffle = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            };

            const createBoard = () => {
                boardElement.innerHTML = '';
                shuffle(cards).forEach((image, index) => {
                    const card = document.createElement('div');
                    card.classList.add('memory-card');
                    card.dataset.index = index;
                    card.innerHTML = `<div class="card-back"><i class="fa-solid fa-circle-question"></i></div><div class="card-front">${image}</div>`;
                    card.addEventListener('click', () => flipCard(card));
                    boardElement.appendChild(card);
                });
                messageElement.innerText = `عدد الحركات: ${moves}`;
            };
            
            const flipCard = (card) => {
                if (!gameActive || flippedCards.length === 2 || card.classList.contains('flipped') || card.classList.contains('matched')) {
                    return;
                }
                
                card.classList.add('flipped');
                flippedCards.push(card);
                
                if (flippedCards.length === 2) {
                    moves++;
                    messageElement.innerText = `عدد الحركات: ${moves}`;
                    checkForMatch();
                }
            };

            const checkForMatch = () => {
                const [card1, card2] = flippedCards;
                const front1 = card1.querySelector('.card-front').innerHTML;
                const front2 = card2.querySelector('.card-front').innerHTML;

                if (front1 === front2) {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedCards.push(card1, card2);
                    flippedCards = [];
                    if (matchedCards.length === cards.length) {
                        messageElement.innerText = `لقد فزت في ${moves} حركة!`;
                        gameActive = false;
                    }
                } else {
                    gameActive = false;
                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        flippedCards = [];
                        gameActive = true;
                    }, 1000);
                }
            };
            
            const reset = () => {
                flippedCards = [];
                matchedCards = [];
                gameActive = true;
                moves = 0;
                boardElement.innerHTML = '';
                createBoard();
                messageElement.innerText = `عدد الحركات: ${moves}`;
            };
            
            createBoard();
            this.reset = reset;
        }

        // Snake Game
        function SnakeGame(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const messageElement = canvas.closest('.game-card').querySelector('.game-message');
            const box = 10;
            let snake = [];
            let food = {};
            let score = 0;
            let d = '';
            let game;
            
            const createFood = () => {
                food = {
                    x: Math.floor(Math.random() * (canvas.width / box)) * box,
                    y: Math.floor(Math.random() * (canvas.height / box)) * box
                };
            };
            
            const draw = () => {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw snake
                for (let i = 0; i < snake.length; i++) {
                    ctx.fillStyle = (i === 0) ? getComputedStyle(document.documentElement).getPropertyValue('--main-color') : '#00e078';
                    ctx.fillRect(snake[i].x, snake[i].y, box, box);
                    ctx.strokeStyle = '#000';
                    ctx.strokeRect(snake[i].x, snake[i].y, box, box);
                }
                
                // Draw food
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--orange-light');
                ctx.fillRect(food.x, food.y, box, box);
                
                let snakeX = snake[0].x;
                let snakeY = snake[0].y;
                
                // Update snake position
                if (d === 'LEFT') snakeX -= box;
                if (d === 'UP') snakeY -= box;
                if (d === 'RIGHT') snakeX += box;
                if (d === 'DOWN') snakeY += box;
                
                // Check for collisions
                if (snakeX < 0 || snakeX >= canvas.width || snakeY < 0 || snakeY >= canvas.height || collision(snakeX, snakeY, snake)) {
                    clearInterval(game);
                    messageElement.innerText = `انتهت اللعبة! نقاطك: ${score}`;
                    return;
                }
                
                // If snake eats food
                if (snakeX === food.x && snakeY === food.y) {
                    score++;
                    messageElement.innerText = `النقاط: ${score}`;
                    createFood();
                } else {
                    snake.pop();
                }
                
                let newHead = { x: snakeX, y: snakeY };
                snake.unshift(newHead);
            };
            
            const collision = (x, y, array) => {
                for (let i = 0; i < array.length; i++) {
                    if (array[i].x === x && array[i].y === y) return true;
                }
                return false;
            };
            
            const direction = (event) => {
                let key = event.keyCode;
                if (key === 37 && d !== 'RIGHT') d = 'LEFT';
                else if (key === 38 && d !== 'DOWN') d = 'UP';
                else if (key === 39 && d !== 'LEFT') d = 'RIGHT';
                else if (key === 40 && d !== 'UP') d = 'DOWN';
            };
            
            const reset = () => {
                clearInterval(game);
                snake = [{ x: 120, y: 120 }];
                score = 0;
                d = '';
                createFood();
                messageElement.innerText = `النقاط: ${score}`;
                game = setInterval(draw, 100);
            };

            document.addEventListener('keydown', direction);
            this.reset = reset;
            reset();
        }
        
        // Brick Breaker
        function BrickBreaker(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const messageElement = canvas.closest('.game-card').querySelector('.game-message');
            
            let ball = { x: canvas.width / 2, y: canvas.height - 30, radius: 5, dx: 2, dy: -2 };
            let paddle = { height: 10, width: 75, x: (canvas.width - 75) / 2, speed: 7, left: false, right: false };
            let bricks = [];
            const brick = { rowCount: 3, columnCount: 5, width: 45, height: 10, padding: 5, offsetTop: 30, offsetLeft: 15 };
            let score = 0;
            let lives = 3;
            let gameActive = true;
            
            const createBricks = () => {
                for (let c = 0; c < brick.columnCount; c++) {
                    bricks[c] = [];
                    for (let r = 0; r < brick.rowCount; r++) {
                        bricks[c][r] = { x: 0, y: 0, status: 1 };
                    }
                }
            };
            
            const drawBricks = () => {
                for (let c = 0; c < brick.columnCount; c++) {
                    for (let r = 0; r < brick.rowCount; r++) {
                        if (bricks[c][r].status === 1) {
                            const brickX = (c * (brick.width + brick.padding)) + brick.offsetLeft;
                            const brickY = (r * (brick.height + brick.padding)) + brick.offsetTop;
                            bricks[c][r].x = brickX;
                            bricks[c][r].y = brickY;
                            ctx.beginPath();
                            ctx.rect(brickX, brickY, brick.width, brick.height);
                            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--orange-light');
                            ctx.fill();
                            ctx.closePath();
                        }
                    }
                }
            };
            
            const drawBall = () => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--main-color');
                ctx.fill();
                ctx.closePath();
            };
            
            const drawPaddle = () => {
                ctx.beginPath();
                ctx.rect(paddle.x, canvas.height - paddle.height, paddle.width, paddle.height);
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--main-color');
                ctx.fill();
                ctx.closePath();
            };
            
            const movePaddle = () => {
                if (paddle.right && paddle.x < canvas.width - paddle.width) {
                    paddle.x += paddle.speed;
                } else if (paddle.left && paddle.x > 0) {
                    paddle.x -= paddle.speed;
                }
            };
            
            const drawScore = () => {
                ctx.font = '12px Poppins, sans-serif';
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.fillText(`النقاط: ${score}`, 8, 20);
            };
            
            const drawLives = () => {
                ctx.font = '12px Poppins, sans-serif';
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
                ctx.fillText(`الفرص: ${lives}`, canvas.width - 65, 20);
            };
            
            const collisionDetection = () => {
                for (let c = 0; c < brick.columnCount; c++) {
                    for (let r = 0; r < brick.rowCount; r++) {
                        const b = bricks[c][r];
                        if (b.status === 1) {
                            if (ball.x > b.x && ball.x < b.x + brick.width && ball.y > b.y && ball.y < b.y + brick.height) {
                                ball.dy = -ball.dy;
                                b.status = 0;
                                score++;
                                if (score === brick.rowCount * brick.columnCount) {
                                    messageElement.innerText = 'تهانينا، لقد فزت!';
                                    gameActive = false;
                                }
                            }
                        }
                    }
                }
            };
            
            const draw = () => {
                if (!gameActive) return;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBricks();
                drawBall();
                drawPaddle();
                drawScore();
                drawLives();
                collisionDetection();
                
                // Wall collision detection
                if (ball.x + ball.dx > canvas.width - ball.radius || ball.x + ball.dx < ball.radius) {
                    ball.dx = -ball.dx;
                }
                if (ball.y + ball.dy < ball.radius) {
                    ball.dy = -ball.dy;
                } else if (ball.y + ball.dy > canvas.height - ball.radius) {
                    if (ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
                        ball.dy = -ball.dy;
                    } else {
                        lives--;
                        if (!lives) {
                            messageElement.innerText = 'انتهت اللعبة!';
                            gameActive = false;
                        } else {
                            ball.x = canvas.width / 2;
                            ball.y = canvas.height - 30;
                            ball.dx = 2;
                            ball.dy = -2;
                            paddle.x = (canvas.width - paddle.width) / 2;
                        }
                    }
                }
                
                movePaddle();
                ball.x += ball.dx;
                ball.y += ball.dy;
                
                requestAnimationFrame(draw);
            };
            
            const keyDownHandler = (e) => {
                if (e.key === 'Right' || e.key === 'ArrowRight') {
                    paddle.right = true;
                } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
                    paddle.left = true;
                }
            };
            
            const keyUpHandler = (e) => {
                if (e.key === 'Right' || e.key === 'ArrowRight') {
                    paddle.right = false;
                } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
                    paddle.left = false;
                }
            };
            
            const reset = () => {
                gameActive = true;
                score = 0;
                lives = 3;
                ball.x = canvas.width / 2;
                ball.y = canvas.height - 30;
                ball.dx = 2;
                ball.dy = -2;
                paddle.x = (canvas.width - paddle.width) / 2;
                messageElement.innerText = '';
                createBricks();
                draw();
            };

            document.addEventListener('keydown', keyDownHandler);
            document.addEventListener('keyup', keyUpHandler);
            this.reset = reset;
            reset();
        }

        window.onload = function () {
            // Instantiate all games
            gameInstances.ttt = new TicTacToe('tic-tac-toe-canvas');
            gameInstances.memory = new MemoryGame('memory-game-board');
            gameInstances.snake = new SnakeGame('snake-canvas');
            gameInstances['brick-breaker'] = new BrickBreaker('brick-breaker-canvas');
        };
    </script>
</body>
</html>
